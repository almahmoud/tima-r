<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="timaR">
<title>2 Formatting all inputs â€¢ timaR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2 Formatting all inputs">
<meta property="og:description" content="timaR">
<meta property="og:image" content="https://taxonomicallyinformedannotation.github.io/tima-r/reference/figures/logo.svg">
<meta property="og:image:alt" content="Taxonomically Informed Metabolite Annotation">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@adafede">
<meta name="twitter:site" content="@adafede">
<meta name="google-site-verification" content="Bt77rpBuC_R-0p62TWtA_ba5rvx-PuSEMv4LHg1UsOo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">timaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/I-intro.html">0 General comments about the infrastructure</a>
    <a class="dropdown-item" href="../articles/II-library.html">1 Preparing your structure-organism pairs library</a>
    <a class="dropdown-item" href="../articles/III-formatting.html">2 Formatting all inputs</a>
    <a class="dropdown-item" href="../articles/IV-processing.html">3 Performing Taxonomically Informed Metabolite Annotation</a>
    <a class="dropdown-item" href="../articles/V-actual-performance.html">4 Actual Performance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/taxonomicallyinformedannotation/tima-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>2 Formatting all inputs</h1>
                        <h4 data-toc-skip class="author">Adriano
Rutz</h4>
            
            <h4 data-toc-skip class="date">2022-11-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/taxonomicallyinformedannotation/tima-r/blob/HEAD/vignettes/III-formatting.Rmd" class="external-link"><code>vignettes/III-formatting.Rmd</code></a></small>
      <div class="d-none name"><code>III-formatting.Rmd</code></div>
    </div>

    
    
<p>This vignette describes how to format all your files.</p>
<div class="section level2">
<h2 id="structural-annotations-of-your-features">Structural annotations of your features<a class="anchor" aria-label="anchor" href="#structural-annotations-of-your-features"></a>
</h2>
<p>For the moment, we support annotations coming from 3 different
annotation tools: <a href="https://gnps.ucsd.edu" class="external-link">GNPS</a>, <a href="https://bio.informatik.uni-jena.de/software/sirius" class="external-link">SIRIUS</a> and
our <em>in lab</em> developed tool, <strong><a href="https://github.com/mandelbrot-project/spectral_lib_matcher" class="external-link">ISDB</a></strong>.
We hope to soon implement SIRIUS support.</p>
<p>In order to perform MS2 annotation based on an <strong>I</strong>n
<strong>S</strong>ilico <strong>D</strong>ata<strong>B</strong>ase,
please follow the following repository: <a href="https://github.com/mandelbrot-project/spectral_lib_matcher" class="external-link">spectral_lib_matcher</a></p>
<p>For Sirius and GNPS, please follow their own documentation.</p>
<div class="section level3">
<h3 id="get-an-example">Get an example<a class="anchor" aria-label="anchor" href="#get-an-example"></a>
</h3>
<div class="section level4">
<h4 id="isdb">ISDB<a class="anchor" aria-label="anchor" href="#isdb"></a>
</h4>
<p>As <a href="https://github.com/mandelbrot-project/spectral_lib_matcher" class="external-link">spectral_lib_matcher</a>
is only in python, for the moment, we provide an example output coming
from the new ISDB. We are working on a better integration. As this comes
by default, you do not need to modify any parameters</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/taxonomicallyinformedannotation/tima-r" class="external-link">"timaR"</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_isdb.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:07 This script <span style="color: #00BB00;">downloads an example of spectral_lib_matcher (ISDB) output. </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:07 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:07 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:07 Loading paths</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">141495</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): short_inchikey, smiles, molecular_formula</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (4): msms_score, matched_peaks, feature_id, exact_mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:09 Script finished in <span style="color: #00BB00;">1.650819 secs</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sirius">SIRIUS<a class="anchor" aria-label="anchor" href="#sirius"></a>
</h4>
<p>As SIRIUS jobs are long to perform, we provide an already computed
SIRIUS Workspace. It has beeen generated on the same MGF as the GNPS and
ISDB jobs with the following command:</p>
<p><code>config --IsotopeSettings.filter true --FormulaSearchDB BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC --Timeout.secondsPerTree 0 --FormulaSettings.enforced HCNOP --Timeout.secondsPerInstance 0 --AdductSettings.detectable [[M + H3N + H]+, [M - H2O + H]+, [M + K]+, [M - H4O2 + H]+, [M + H]+, [M + Na]+] --UseHeuristic.mzToUseHeuristicOnly 650 --AlgorithmProfile orbitrap --IsotopeMs2Settings IGNORE --MS2MassDeviation.allowedMassDeviation 5.0ppm --NumberOfCandidatesPerIon 1 --UseHeuristic.mzToUseHeuristic 300 --FormulaSettings.detectable B,Cl,Br,Se,S --NumberOfCandidates 10 --ZodiacNumberOfConsideredCandidatesAt300Mz 10 --ZodiacRunInTwoSteps true --ZodiacEdgeFilterThresholds.minLocalConnections 10 --ZodiacEdgeFilterThresholds.thresholdFilter 0.95 --ZodiacEpochs.burnInPeriod 2000 --ZodiacEpochs.numberOfMarkovChains 10 --ZodiacNumberOfConsideredCandidatesAt800Mz 50 --ZodiacEpochs.iterations 20000 --AdductSettings.enforced , --AdductSettings.fallback [[M + K]+, [M + H]+, [M + Na]+] --FormulaResultThreshold true --InjectElGordoCompounds true --StructureSearchDB BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC --RecomputeResults false formula zodiac fingerprint structure canopus</code></p>
<p>These parameters were not optimized and were only used to give an
example output.</p>
<p>Then, the summaries have been generated using:</p>
<p><code>sirius -i inst/extdata/interim/annotations/sirius_example/ write-summaries -c --digits 3</code></p>
<p>You can get the example running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_sirius.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:09 This script <span style="color: #00BB00;">downloads an example of SIRIUS output. </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:09 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:09 Contributors: ...</span></span>
<span><span class="co">#&gt; Timeout for download is 600 seconds</span></span>
<span><span class="co">#&gt; 2022-11-15 11:38:09 Loading paths</span></span>
<span><span class="co">#&gt; Downloading</span></span>
<span><span class="co">#&gt; Unzipping</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Script finished in <span style="color: #00BB00;">1.144951 mins</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="gnps">GNPS<a class="anchor" aria-label="anchor" href="#gnps"></a>
</h4>
<p>We also provide an example GNPS job id, which is:
<code>96fa7c88200e4a03bee4644e581e3fb0</code></p>
</div>
</div>
<div class="section level3">
<h3 id="formatting">Formatting<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h3>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_*yourAnnotationTool*.yaml</code>.</p>
<p>Depending on the annotation tool you used, you can format its results
using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_gnps.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 This script <span style="color: #00BB00;">formats GNPS (and NAP) results</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Loading and formatting GNPS results </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:18 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">526745</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">769</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">46</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (29): SpectrumID, Compound_Name, Ion_Source, Instrument, Compound_Source...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (17): Precursor_MZ, ExactMass, Charge, Library_Class, #Scan#, MQScore, T...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 ... path to export is data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_gnps_pretreated.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Script finished in <span style="color: #00BB00;">8.32319 secs</span></span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_isdb.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 This script <span style="color: #00BB00;">formats ISDB results</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Loading and formatting ISDB results </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:26 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">526745</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">141495</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): short_inchikey, smiles, molecular_formula</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (4): msms_score, matched_peaks, feature_id, exact_mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:39 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:39 ... path to export is data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_pretreated.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Script finished in <span style="color: #00BB00;">15.47137 secs</span></span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_sirius.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 This script <span style="color: #00BB00;">formats SIRIUS results</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:42 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:39:44 Loading and formatting SIRIUS results</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5070</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">20</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (12): id, molecularFormula, adduct, NPC#pathway, NPC#superclass, NPC#cla...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span>  (8): NPC#pathway Probability, NPC#superclass Probability, NPC#class Pro...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6158</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">17</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (5): molecularFormula, adduct, precursorFormula, lipidClass, id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (12): rank, ZodiacScore, SiriusScore, TreeScore, IsotopeScore, numExplai...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6158</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">17</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (5): molecularFormula, adduct, precursorFormula, lipidClass, id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (12): rank, ZodiacScore, SiriusScore, TreeScore, IsotopeScore, numExplai...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5024</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">21</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (10): ConfidenceScore, molecularFormula, adduct, InChIkey2D, InChI, name...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (11): rank, formulaRank, #adducts, #predictedFPs, CSI:FingerIDScore, Zod...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5024</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">21</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (10): ConfidenceScore, molecularFormula, adduct, InChIkey2D, InChI, name...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (11): rank, formulaRank, #adducts, #predictedFPs, CSI:FingerIDScore, Zod...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:07 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">526745</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; Joining, by = c("feature_id", "molecular_formula")</span></span>
<span><span class="co">#&gt; Joining, by = "feature_id"</span></span>
<span><span class="co">#&gt; Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; Warning: 9715 features have no exact mass. This is somehow unexpected and under investigation.2022-11-15 11:45:18 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:18 ... path to export is data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_sirius_pretreated.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 Script finished in <span style="color: #00BB00;">5.648184 mins</span></span></span></code></pre></div>
<p>You now have your annotations well prepared and can keep on
formatting the rest of your metadata</p>
</div>
</div>
<div class="section level2">
<h2 id="chemical-class-annotation-of-your-features">Chemical class annotation of your features<a class="anchor" aria-label="anchor" href="#chemical-class-annotation-of-your-features"></a>
</h2>
<p>Within our workflow, we offer a new way to attribute chemical classes
to your features. It is analog to <a href="https://ccms-ucsd.github.io/GNPSDocumentation/nap/" class="external-link">Network
Annotation Propagation</a>, but uses the edges of your network instead
of the clusters. This makes more sense in our view, as also recently
illustrated by <a href="https://doi.org/10.1038/s41587-020-0740-8" class="external-link">CANOPUS</a>.</p>
<p>All steps can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>We are currently also working on CANOPUS integration for chemical
class annotation but this implies way heavier computations and we want
to offer our users a <strong>fast</strong> solution.</p>
<div class="section level4">
<h4 id="case-when-no-network-available">Case when no network available<a class="anchor" aria-label="anchor" href="#case-when-no-network-available"></a>
</h4>
<p>If no network was generated, simply use the <code>fake_edges</code>
and <code>fake_features_components</code> steps instead of the
<code>prepare_edges</code> and <code>prepare_features_components</code>
steps. This will mimic a false network that allows to proceed to the
next steps. However, this will not help chemical weighting.</p>
<p>If needed, you can get an example of what your minimal feature table
should look like by running (no parameters needed):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_feature_table.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 This script <span style="color: #00BB00;">downloads an example of minimal feature table </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:21 Loading paths</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (3): RTMean, cluster index, precursor mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Script finished in <span style="color: #00BB00;">2.251495 secs</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="formatting-1">Formatting<a class="anchor" aria-label="anchor" href="#formatting-1"></a>
</h3>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_edges.yaml</code>,
<code>config/params/prepare_features_components.yaml</code>, and
<code>config/params/prepare_features_classification.yaml</code>
accordingly.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_edges.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 This script <span style="color: #00BB00;">prepares edges</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:23 Loading edge table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">14453</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (1): EdgeAnnotation</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): CLUSTERID1, CLUSTERID2, DeltaMZ, MEH, Cosine, OtherScore, Component...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Formatting edge table </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 ... path to export is data/interim/edges/96fa7c88200e4a03bee4644e581e3fb0_edges.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Script finished in <span style="color: #00BB00;">1.048534 secs</span></span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_components.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 This script <span style="color: #00BB00;">prepares features metadata (mz, rt and component id)</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 Loading files ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:24 ... features table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">141887</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">12</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (5): smiles, molecular_formula, inchikey_2D, library, smiles_2D</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (3): feature_id, structure_exact_mass, score_input</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span> (4): inchikey, structure_taxonomy_npclassifier_01pathway, structure_taxo...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:25 ... cluster table </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:25 THIS STEP CAN BE IMPROVED BY CALCULATING THE CLUSTERS WITHIN SPEC2VEC</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">32</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (8): ATTRIBUTE_species, GNPSLinkout_Cluster, GNPSLinkout_Network, INCHI...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (24): G1, G2, G3, G4, G5, G6, GNPSGROUP:Arnica montana, GNPSGROUP:BLK, G...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:27 Adding components to features</span></span>
<span><span class="co">#&gt; Joining, by = "feature_id"</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:27 Calculating mz error </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:27 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:27 ... path to export is data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_filled.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Script finished in <span style="color: #00BB00;">3.386044 secs</span></span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_classification.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 This script <span style="color: #00BB00;">prepares features metadata (chemical classes)</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 Loading files ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:28 ... library</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">779214</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (6): structure_inchikey_2D, structure_smiles_2D, structure_molecular_for...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structure_exact_mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 ... features table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">146988</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">14</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (4): inchikey_2D, smiles_2D, molecular_formula, library</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): feature_id, component_id, rt, mz, structure_exact_mass, score_input...</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span> (3): structure_taxonomy_npclassifier_01pathway, structure_taxonomy_npcla...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 Filtering structures ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 ... missing classification </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 ... missing masses </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 ... missing formulas </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 ... keeping the other ones safe</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:32 Completing the structures with the library</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:33 Filtering structures again (to calculate this time) ...</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_01pathway",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_02superclass",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_03class")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "structure_exact_mass")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "molecular_formula")</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:33 Calculation is not performed yet (TODO) ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:33 Recombining everything back together</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_01pathway",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_02superclass",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_03class")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "molecular_formula")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "structure_exact_mass")</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:34 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:34 ... path to export is data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_treated.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Script finished in <span style="color: #00BB00;">7.096458 secs</span></span></span></code></pre></div>
<p>Your features are now not only informed with structural information
but also, chemical class information. The latter might be corresponding
<strong>or not</strong> to the chemical class of your annotated
structure, depending on the consistency of your annotations.</p>
</div>
</div>
<div class="section level2">
<h2 id="biological-source-annotation">Biological source annotation<a class="anchor" aria-label="anchor" href="#biological-source-annotation"></a>
</h2>
<p>This step allows you to attribute biological source information to
your features. If all your features come from a single extract, it will
attribute the biological source of your extract to all your features. If
you have multiple extracts aligned, it will take the <em>n</em>
(according to your parameters) highest intensities of your aligned
feature table and attribute the biological source of corresponding
extracts. It can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_taxa.yaml</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_taxa.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 This script <span style="color: #00BB00;">informs taxonomically features</span> </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Authors:  <span style="color: #00BB00;">AR</span> , <span style="color: #0000BB;">PMA</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Loading taxa ranks dictionary</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">17</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (2): taxaRank, taxaRankStandard</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:35 Loading feature table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (9): row ID, row m/z, row retention time, 0_AR_Blk_C18_Pos.mzML Peak are...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:36 Loading metadata table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (2): filename, ATTRIBUTE_species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:36 Formatting feature table ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:36 ... WARNING: requires 'Peak area' in columns (MZmine format) </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:36 ... filtering top K intensities per feature </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:37 Keeping list of organisms to submit to OTL</span></span>
<span><span class="co">#&gt; Warning: BLK are not matched</span></span>
<span><span class="co">#&gt; Joining, by = "search_string"</span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:38 Joining top K with metadata table </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:38 Joining with cleaned taxonomy table </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:39 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:39 ... path to export is data/interim/taxa/96fa7c88200e4a03bee4644e581e3fb0_taxed.tsv.gz </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:39 ... path to used parameters is data/interim/config </span></span>
<span><span class="co">#&gt; 2022-11-15 11:45:39 Script finished in <span style="color: #00BB00;">4.336901 secs</span></span></span></code></pre></div>
<p>We now recommend you to read the <a href="https://taxonomicallyinformedannotation.github.io/tima-r/articles/3-processing.html">next
vignette</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adriano Rutz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
