<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="timaR">
<title>3 Formatting all inputs â€¢ timaR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3 Formatting all inputs">
<meta property="og:description" content="timaR">
<meta property="og:image" content="https://taxonomicallyinformedannotation.github.io/tima-r/reference/figures/logo.svg">
<meta property="og:image:alt" content="Taxonomically Informed Metabolite Annotation">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@adafede">
<meta name="twitter:site" content="@adafede">
<meta name="google-site-verification" content="Bt77rpBuC_R-0p62TWtA_ba5rvx-PuSEMv4LHg1UsOo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">timaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/I-intro.html">1 General comments about the infrastructure</a>
    <a class="dropdown-item" href="../articles/II-inputs.html">2 Inputs: Getting everything you need</a>
    <a class="dropdown-item" href="../articles/III-formatting.html">3 Formatting all inputs</a>
    <a class="dropdown-item" href="../articles/IV-processing.html">4 Performing Taxonomically Informed Metabolite Annotation</a>
    <a class="dropdown-item" href="../articles/V-actual-performance.html">5 Actual Performance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/taxonomicallyinformedannotation/tima-r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>3 Formatting all inputs</h1>
                        <h4 data-toc-skip class="author">Adriano
Rutz</h4>
            
            <h4 data-toc-skip class="date">2022-11-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/taxonomicallyinformedannotation/tima-r/blob/HEAD/vignettes/III-formatting.Rmd" class="external-link"><code>vignettes/III-formatting.Rmd</code></a></small>
      <div class="d-none name"><code>III-formatting.Rmd</code></div>
    </div>

    
    
<p>This vignette describes how to format all your files.</p>
<div class="section level2">
<h2 id="structural-annotations-of-your-features">Structural annotations of your features<a class="anchor" aria-label="anchor" href="#structural-annotations-of-your-features"></a>
</h2>
<p>For the moment, we support annotations coming from 3 different
annotation tools:</p>
<ul>
<li><a href="https://gnps.ucsd.edu" class="external-link">GNPS</a></li>
<li><a href="https://bio.informatik.uni-jena.de/software/sirius" class="external-link">SIRIUS</a></li>
<li>Formatted results of <strong>ISDB</strong> annotation.</li>
</ul>
<p>In order to perform MS2 annotation based on an <strong>I</strong>n
<strong>S</strong>ilico <strong>D</strong>ata<strong>B</strong>ase,
please follow the following steps.</p>
<div class="section level3">
<h3 id="isdb">ISDB<a class="anchor" aria-label="anchor" href="#isdb"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/taxonomicallyinformedannotation/tima-r" class="external-link">"timaR"</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/process_spectra.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; This script <span style="color: #00BB00;">performs spectral similarity calculation. </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span>2022-11-25 11:19:55 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:55 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:55 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:55 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:55 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:55 Loading spectra </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:56 Loading spectral library (Can take long) </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:56 Performing spectral comparison </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 Formatting results</span></span>
<span><span class="co">#&gt; Joining, by = "target_id"</span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 ... path to export is <span style="color: #00BB00;">data/interim/annotations/example_isdb.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 Script finished in <span style="color: #00BB00;">1.945311 secs</span></span></span></code></pre></div>
<p>In case, a python implementation of the spectral matching steps is
also available at: <a href="https://github.com/mandelbrot-project/spectral_lib_matcher" class="external-link uri">https://github.com/mandelbrot-project/spectral_lib_matcher</a>.
The python version also includes more elaborated similarity
measures.</p>
</div>
<div class="section level3">
<h3 id="sirius-gnps-and-others">Sirius, GNPS, and others<a class="anchor" aria-label="anchor" href="#sirius-gnps-and-others"></a>
</h3>
<p>For Sirius and GNPS, please follow their own documentation. If you
have some annotations coming from a different tool, please format them
as the provided examples.</p>
<div class="section level4">
<h4 id="sirius">SIRIUS<a class="anchor" aria-label="anchor" href="#sirius"></a>
</h4>
<p>As SIRIUS jobs are long to perform, we provide an already computed
SIRIUS Workspace. It has beeen generated on the same MGF as the GNPS and
ISDB jobs with the following command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">config</span> <span class="at">--IsotopeSettings.filter</span> true <span class="at">--FormulaSearchDB</span> BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC <span class="at">--Timeout.secondsPerTree</span> 0 <span class="at">--FormulaSettings.enforced</span> HCNOP <span class="at">--Timeout.secondsPerInstance</span> 0 <span class="at">--AdductSettings.detectable</span> [[M + H3N + H]+, [M <span class="at">-</span> H2O + H]+, [M + K]+, [M <span class="at">-</span> H4O2 + H]+, [M + H]+, [M + Na]+] <span class="at">--UseHeuristic.mzToUseHeuristicOnly</span> 650 <span class="at">--AlgorithmProfile</span> orbitrap <span class="at">--IsotopeMs2Settings</span> IGNORE <span class="at">--MS2MassDeviation.allowedMassDeviation</span> 5.0ppm <span class="at">--NumberOfCandidatesPerIon</span> 1 <span class="at">--UseHeuristic.mzToUseHeuristic</span> 300 <span class="at">--FormulaSettings.detectable</span> B,Cl,Br,Se,S <span class="at">--NumberOfCandidates</span> 10 <span class="at">--ZodiacNumberOfConsideredCandidatesAt300Mz</span> 10 <span class="at">--ZodiacRunInTwoSteps</span> true <span class="at">--ZodiacEdgeFilterThresholds.minLocalConnections</span> 10 <span class="at">--ZodiacEdgeFilterThresholds.thresholdFilter</span> 0.95 <span class="at">--ZodiacEpochs.burnInPeriod</span> 2000 <span class="at">--ZodiacEpochs.numberOfMarkovChains</span> 10 <span class="at">--ZodiacNumberOfConsideredCandidatesAt800Mz</span> 50 <span class="at">--ZodiacEpochs.iterations</span> 20000 <span class="at">--AdductSettings.enforced</span> , <span class="at">--AdductSettings.fallback</span> [[M + K]+, [M + H]+, [M + Na]+] <span class="at">--FormulaResultThreshold</span> true <span class="at">--InjectElGordoCompounds</span> true <span class="at">--StructureSearchDB</span> BIO,COCONUT,GNPS,KNAPSACK,UNDP,PLANTCYC <span class="at">--RecomputeResults</span> false formula zodiac fingerprint structure canopus</span></code></pre></div>
<p>These parameters were not optimized and were only used to give an
example output.</p>
<p>Then, the summaries have been generated using:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sirius</span> <span class="at">-i</span> inst/extdata/interim/annotations/sirius_example/ write-summaries <span class="at">-c</span> <span class="at">--digits</span> 3</span></code></pre></div>
<p>You can get the example running:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_sirius.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 This script <span style="color: #00BB00;">downloads an example of SIRIUS output. </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 Contributors: ...</span></span>
<span><span class="co">#&gt; Timeout for download is 600 seconds</span></span>
<span><span class="co">#&gt; 2022-11-25 11:19:57 Loading paths</span></span>
<span><span class="co">#&gt; Downloading</span></span>
<span><span class="co">#&gt; Unzipping</span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Script finished in <span style="color: #00BB00;">2.320584 mins</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="gnps">GNPS<a class="anchor" aria-label="anchor" href="#gnps"></a>
</h4>
<p>We also provide an example GNPS job id, which is:
<code>96fa7c88200e4a03bee4644e581e3fb0</code></p>
</div>
</div>
<div class="section level3">
<h3 id="formatting">Formatting<a class="anchor" aria-label="anchor" href="#formatting"></a>
</h3>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_*yourAnnotationTool*.yaml</code>.</p>
<p>Depending on the annotation tool you used, you can format its results
using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_gnps.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 This script <span style="color: #00BB00;">formats GNPS (and NAP) results</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Loading and formatting GNPS results </span></span>
<span><span class="co">#&gt; 2022-11-25 11:22:17 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; Downloading structure_metadata.tsv.gz from https://doi.org/10.5281/zenodo.6378223 (The LOTUS Initiative for Open Natural Products Research: metadata; version: 4)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">529177</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">769</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">46</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (29): SpectrumID, Compound_Name, Ion_Source, Instrument, Compound_Source...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (17): Precursor_MZ, ExactMass, Charge, Library_Class, #Scan#, MQScore, T...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 ... path to export is <span style="color: #00BB00;">data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_gnps_pretreated.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Script finished in <span style="color: #00BB00;">7.016312 mins</span></span></span></code></pre></div>
<p>and/or</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_isdb.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 This script <span style="color: #00BB00;">formats ISDB results</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Loading and formatting ISDB results </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:18 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; A file with the same size is already present. Skipping</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">529177</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">22</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): short_inchikey, smiles, molecular_formula</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (4): feature_id, target_id, msms_score, exact_mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 ... path to export is <span style="color: #00BB00;">data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_pretreated.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Script finished in <span style="color: #00BB00;">12.32265 secs</span></span></span></code></pre></div>
<p>and/or</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_sirius.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 This script <span style="color: #00BB00;">formats SIRIUS results</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:30 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:29:31 Loading and formatting SIRIUS results</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5070</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">20</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (12): id, molecularFormula, adduct, NPC#pathway, NPC#superclass, NPC#cla...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span>  (8): NPC#pathway Probability, NPC#superclass Probability, NPC#class Pro...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6158</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">17</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (5): molecularFormula, adduct, precursorFormula, lipidClass, id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (12): rank, ZodiacScore, SiriusScore, TreeScore, IsotopeScore, numExplai...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6158</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">17</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (5): molecularFormula, adduct, precursorFormula, lipidClass, id</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (12): rank, ZodiacScore, SiriusScore, TreeScore, IsotopeScore, numExplai...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5024</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">21</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (10): ConfidenceScore, molecularFormula, adduct, InChIkey2D, InChI, name...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (11): rank, formulaRank, #adducts, #predictedFPs, CSI:FingerIDScore, Zod...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">5024</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">21</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (10): ConfidenceScore, molecularFormula, adduct, InChIkey2D, InChI, name...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (11): rank, formulaRank, #adducts, #predictedFPs, CSI:FingerIDScore, Zod...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:32:58 Trying to look for already computed metadata</span></span>
<span><span class="co">#&gt; A file with the same size is already present. Skipping</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">529177</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span><span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (3): structureCleaned_smiles2D, structureCleaned_inchikey2D, structureCl...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structureCleaned_exactMass</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.Joining, by = c("feature_id", "molecular_formula")Joining, by = "feature_id"Joining, by = "inchikey_2D"</span></span>
<span><span class="co">#&gt; Warning: 9711 features have no exact mass. This is somehow unexpected and under investigation.2022-11-25 11:33:11 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:11 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:11 ... path to export is <span style="color: #00BB00;">data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_sirius_pretreated.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:15 Script finished in <span style="color: #00BB00;">3.736179 mins</span></span></span></code></pre></div>
<p>You now have your annotations well prepared and can keep on
formatting the rest of your metadata.</p>
</div>
</div>
<div class="section level2">
<h2 id="chemical-class-annotation-of-your-features">Chemical class annotation of your features<a class="anchor" aria-label="anchor" href="#chemical-class-annotation-of-your-features"></a>
</h2>
<p>Within our workflow, we offer a new way to attribute chemical classes
to your features. It is analog to <a href="https://ccms-ucsd.github.io/GNPSDocumentation/nap/" class="external-link">Network
Annotation Propagation</a>, but uses the edges of your network instead
of the clusters. This makes more sense in our view, as also recently
illustrated by <a href="https://doi.org/10.1038/s41587-020-0740-8" class="external-link">CANOPUS</a>.</p>
<p>All steps can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>We are currently also working on CANOPUS integration for chemical
class annotation but this implies way heavier computations and we want
to offer our users a <strong>fast</strong> solution.</p>
<div class="section level3">
<h3 id="case-when-no-network-available">Case when no network available<a class="anchor" aria-label="anchor" href="#case-when-no-network-available"></a>
</h3>
<p>If no network was generated, simply use the <code>fake_edges</code>
and <code>fake_features_components</code> steps instead of the
<code>prepare_edges</code> and <code>prepare_features_components</code>
steps. This will mimic a false network that allows to proceed to the
next steps. However, this will not help chemical weighting.</p>
<p>If needed, you can get an example of what your minimal feature table
should look like by running (no parameters needed):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/get_example_feature_table.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:15 This script <span style="color: #00BB00;">downloads an example of minimal feature table </span></span></span>
<span><span class="co"><span style="color: #00BB00;">#&gt; </span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:15 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:15 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:15 Loading paths</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (3): RTMean, cluster index, precursor mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Script finished in <span style="color: #00BB00;">1.373875 secs</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="formatting-1">Formatting<a class="anchor" aria-label="anchor" href="#formatting-1"></a>
</h3>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_edges.yaml</code>,
<code>config/params/prepare_features_components.yaml</code>, and
<code>config/params/prepare_features_classification.yaml</code>
accordingly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_edges.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 This script <span style="color: #00BB00;">prepares edges</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:16 Loading edge table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">14453</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (1): EdgeAnnotation</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): CLUSTERID1, CLUSTERID2, DeltaMZ, MEH, Cosine, OtherScore, Component...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Formatting edge table </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 ... path to export is <span style="color: #00BB00;">data/interim/edges/96fa7c88200e4a03bee4644e581e3fb0_edges.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Script finished in <span style="color: #00BB00;">0.6408489 secs</span></span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_components.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 This script <span style="color: #00BB00;">prepares features metadata (mz, rt and component id)</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 Loading files ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 ... features table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">22</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">12</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (5): smiles, molecular_formula, inchikey_2D, library, smiles_2D</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (3): feature_id, structure_exact_mass, score_input</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span> (4): inchikey, structure_taxonomy_npclassifier_01pathway, structure_taxo...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 ... cluster table </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:17 THIS STEP CAN BE IMPROVED BY CALCULATING THE CLUSTERS WITHIN SPEC2VEC</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">32</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (8): ATTRIBUTE_species, GNPSLinkout_Cluster, GNPSLinkout_Network, INCHI...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (24): G1, G2, G3, G4, G5, G6, GNPSGROUP:Arnica montana, GNPSGROUP:BLK, G...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Adding components to features</span></span>
<span><span class="co">#&gt; Joining, by = "feature_id"</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Calculating mz error </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 ... path to export is <span style="color: #00BB00;">data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_filled.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Script finished in <span style="color: #00BB00;">1.236037 secs</span></span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_features_classification.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 This script <span style="color: #00BB00;">prepares features metadata (chemical classes)</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Authors:  <span style="color: #00BB00;">AR</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 Loading files ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:18 ... library</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">779214</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (6): structure_inchikey_2D, structure_smiles_2D, structure_molecular_for...</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (1): structure_exact_mass</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... features table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7899</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">14</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (4): inchikey_2D, smiles_2D, molecular_formula, library</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (7): feature_id, component_id, rt, mz, structure_exact_mass, score_input...</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span> (3): structure_taxonomy_npclassifier_01pathway, structure_taxonomy_npcla...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Filtering structures ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... missing classification </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... missing masses </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... missing formulas </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... keeping the other ones safe</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Completing the structures with the library</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D")</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Filtering structures again (to calculate this time) ...</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_01pathway",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_02superclass",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_03class")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "structure_exact_mass")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "molecular_formula")</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Calculation is not performed yet (TODO) ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Recombining everything back together</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_01pathway",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_02superclass",</span></span>
<span><span class="co">#&gt; "structure_taxonomy_npclassifier_03class")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "molecular_formula")</span></span>
<span><span class="co">#&gt; Joining, by = c("inchikey_2D", "smiles_2D", "structure_exact_mass")</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 ... path to export is <span style="color: #00BB00;">data/interim/annotations/96fa7c88200e4a03bee4644e581e3fb0_isdb_treated.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Script finished in <span style="color: #00BB00;">6.178094 secs</span></span></span></code></pre></div>
<p>Your features are now not only informed with structural information
but also, chemical class information. The latter might be corresponding
<strong>or not</strong> to the chemical class of your annotated
structure, depending on the consistency of your annotations.</p>
</div>
</div>
<div class="section level2">
<h2 id="biological-source-annotation">Biological source annotation<a class="anchor" aria-label="anchor" href="#biological-source-annotation"></a>
</h2>
<p>This step allows you to attribute biological source information to
your features. If all your features come from a single extract, it will
attribute the biological source of your extract to all your features. If
you have multiple extracts aligned, it will take the <em>n</em>
(according to your parameters) highest intensities of your aligned
feature table and attribute the biological source of corresponding
extracts. It can take both manual inputs or GNPS metadata directly from
your GNPS job ID.</p>
<p>Before running the corresponding code, do not forget to modify
<code>config/params/prepare_taxa.yaml</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"inst/scripts/prepare_taxa.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 This script <span style="color: #00BB00;">informs taxonomically features</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Authors:  <span style="color: #00BB00;">AR</span> , <span style="color: #0000BB;">PMA</span> </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Contributors: ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Loading paths </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Loading yaml parameters </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Loading command line arguments </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:24 Loading taxa ranks dictionary</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">17</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (2): taxaRank, taxaRankStandard</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:25 Loading feature table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">7897</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (9): row ID, row m/z, row retention time, 0_AR_Blk_C18_Pos.mzML Peak are...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:25 Loading metadata table</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">6</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â”€â”€</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> "\t"</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span> (2): filename, ATTRIBUTE_species</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:25 Formatting feature table ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:25 ... WARNING: requires 'Peak area' in columns (MZmine format) </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:25 ... filtering top K intensities per feature </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:26 Keeping list of organisms to submit to OTL</span></span>
<span><span class="co">#&gt; Warning: BLK are not matched</span></span>
<span><span class="co">#&gt; Joining, by = "search_string"</span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:26 Joining top K with metadata table </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:26 Joining with cleaned taxonomy table </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:28 Exporting ... </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:28 ... path to used parameters is <span style="color: #00BB00;">data/interim/config</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:28 ... path to export is <span style="color: #00BB00;">data/interim/taxa/96fa7c88200e4a03bee4644e581e3fb0_taxed.tsv.gz</span> </span></span>
<span><span class="co">#&gt; 2022-11-25 11:33:28 Script finished in <span style="color: #00BB00;">3.232216 secs</span></span></span></code></pre></div>
<p>We now recommend you to read the <a href="https://taxonomicallyinformedannotation.github.io/tima-r/articles/IV-processing.html">next
vignette</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adriano Rutz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
