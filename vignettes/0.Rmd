---
title: "0 General comments about the infrastructure"
author: "Adriano Rutz"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{0 General comments about the infrastructure}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette describes the philosophy behind the infrastructure of **TIMA**.

It is currently under construction. 

## Philosophy

Our main goals were **flexibility** and **reproducibility**. 

### Flexibility

To ensure flexibility, we tried to split the process in as much tiny parts as needed.
So you can decide whether to skip an optional part, add your own processing, etc.
We tried to cover most use cases, but of course they are not exhaustive. 
If you feel like something useful to other users is missing, please fill an [issue](https://github.com/taxonomicallyinformedannotation/tima-r/issues).

### Reproducibility

After some time using TIMA, you will probably wonder: 
"*What was the parameters I used to generate this file?*" ...
Or a collaborator might ask you to share your data and parameters.
Writing them down each time might be time consuming and not really in line with modern computational approaches.
Therefore, we chose to implement all parameters of all steps (almost...) as **YAML** files.
They are human-readable and can be used in batches.
If you do not like YAML, parameters of each steps can also be given as command line arguments.
They will then be saved as YAML you will be able to share.

TODO EXAMPLE

## Use

Under construction
Until it is finished, here are the most relevant commands

### Copy initial parameters


```shell
# copy the default params to adapat to your data later on
cp -R config/default config/params
```

### Structure-organism pairs library

```shell
Rscript inst/scripts/get_lotus.R
Rscript inst/scripts/prepare_lotus.R
# Rscript inst/scripts/prepare_closed.R # only if you have access to it
Rscript inst/scripts/prepare_library.R
Rscript inst/scripts/prepare_adducts.R
```

### Annotations

#### Get MS2 annotations

```shell
# (spectral_lib_matcher, which is only in python. see related repo)
# instead we provide an example file coming from the new ISDB.
# It also works with annotations coming from GNPS (see next steps)
Rscript inst/scripts/get_example_isdb.R
```

#### Format MS2 annotations

```shell
# depending on the annotation tool you used
Rscript inst/scripts/prepare_gnps.R # optional
Rscript inst/scripts/prepare_sirius.R # optional
Rscript inst/scripts/prepare_isdb.R
```

#### Complement MS2 annotations (with spectral clusters and chemical taxonomy of annotations)

```shell
Rscript inst/scripts/prepare_edges.R
Rscript inst/scripts/prepare_features_components.R
Rscript inst/scripts/prepare_features_classification.R
```

#### Get biological taxonomy information

```shell
Rscript inst/scripts/prepare_taxa.R
```

### And finally the graal!

```shell
Rscript inst/scripts/process_annotations.R
```

NOTE: you can use --help or -h argument for all .R steps to get more info

Rest to come ...
